{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar _this = this;\n\nimport Header from '../components/admin/Header';\nimport Footer from '../components/admin/Footer';\nimport React, { useState, useEffect } from 'react';\nimport { connect } from 'react-redux';\nimport SmsPagination from '../components/admin/SmsPagination';\nimport { useRouter } from 'next/router';\nimport cookie from 'js-cookie';\nimport axios from 'axios';\nimport SmsList from '../components/admin/SmsList';\nimport InputMask from \"react-input-mask\";\nimport { phoneCheck } from '../defaults/validations';\nimport { ExportCSV } from '../components/admin/ExportCSV';\n\nfunction mapStateToProps(state) {\n  return {\n    adminReducer: state.adminReducer\n  };\n}\n\nvar AdminSmsCenter = function AdminSmsCenter(_ref) {\n  var adminReducer = _ref.adminReducer;\n  var router = useRouter();\n\n  var _useState = useState([]),\n      smsList = _useState[0],\n      setSmsList = _useState[1];\n\n  var _useState2 = useState([]),\n      smsTypes = _useState2[0],\n      setSmsTypes = _useState2[1];\n\n  var _useState3 = useState(null),\n      total = _useState3[0],\n      setTotal = _useState3[1];\n\n  var _useState4 = useState(null),\n      lastPage = _useState4[0],\n      setLastPage = _useState4[1];\n\n  var _useState5 = useState(1),\n      currentPage = _useState5[0],\n      setCurrentPage = _useState5[1];\n\n  var _useState6 = useState(15),\n      toList = _useState6[0],\n      setToList = _useState6[1];\n\n  var _useState7 = useState(1),\n      from = _useState7[0],\n      setFrom = _useState7[1];\n\n  var _useState8 = useState([]),\n      file = _useState8[0],\n      setFile = _useState8[1];\n\n  var _useState9 = useState(true),\n      loading = _useState9[0],\n      setLoading = _useState9[1];\n\n  var adminCookie = cookie.get('admin_token');\n  var phone = router.query.phone;\n  var start = router.query.start;\n  var end = router.query.end;\n  var page = router.query.page;\n  var sms_type = router.query.sms_type;\n\n  var _useState10 = useState(phone ? phone : ''),\n      phoneNumber = _useState10[0],\n      setPhoneNumber = _useState10[1];\n\n  var _useState11 = useState(start ? start : ''),\n      dateFrom = _useState11[0],\n      setDateFrom = _useState11[1];\n\n  var _useState12 = useState(end ? end : ''),\n      dateTo = _useState12[0],\n      setDateTo = _useState12[1];\n\n  var _useState13 = useState(sms_type ? sms_type : ''),\n      smsType = _useState13[0],\n      setSmsType = _useState13[1];\n\n  var beforeMaskedValueChange = function beforeMaskedValueChange(newState, oldState, userInput) {\n    var value = newState.value;\n    var selection = newState.selection;\n    var cursorPosition = selection ? selection.start : null; // keep minus if entered by user\n\n    if (value.endsWith('-') && userInput !== '-' && !_this.state.value.endsWith('-')) {\n      if (cursorPosition === value.length) {\n        cursorPosition--;\n        selection = {\n          start: cursorPosition,\n          end: cursorPosition\n        };\n      }\n\n      value = value.slice(0, -1);\n    }\n  };\n\n  var onChangePhone = function onChangePhone(e) {\n    setPhoneNumber(e.target.value);\n  };\n\n  var sendRequest = function sendRequest() {\n    setLoading(true);\n    axios.get(\"\".concat(process.env.BASE_URL, \"/exportSms\"), {\n      params: {\n        token: adminCookie,\n        phone: phone,\n        date_from: start,\n        date_to: end,\n        sms_type: sms_type\n      }\n    }).then(function (res) {\n      setLoading(false);\n      setFile(res.data);\n    });\n  };\n\n  var requestUpdate = function requestUpdate(res) {\n    setCurrentPage(res.data.current_page);\n    setSmsList(res.data.data);\n    setLastPage(res.data.last_page);\n    setTotal(res.data.total);\n    setToList(res.data.to);\n    setFrom(res.data.from);\n  };\n\n  var clearForm = function clearForm(e) {\n    setFile([]);\n    setDateFrom('');\n    setDateTo('');\n    setPhoneNumber('');\n    setSmsType('');\n    setLoading(true);\n    axios.get(\"\".concat(process.env.BASE_URL, \"/smsFilter\"), {\n      params: _defineProperty({\n        token: adminCookie,\n        phone: '',\n        page: '',\n        date_from: '',\n        date_to: '',\n        sms_type: ''\n      }, \"page\", '')\n    }, {\n      headers: {\n        'Access-Control-Allow-Origin': '*',\n        'Content-Type': 'application/json'\n      }\n    }).then(function (res) {\n      setLoading(false);\n\n      if (!res.data.message) {\n        requestUpdate(res);\n      }\n    });\n    router.push('/smscenter');\n    e.preventDefault();\n  };\n\n  var onClear = function onClear() {\n    setFile([]);\n    setLoading(true);\n    axios.get(\"\".concat(process.env.BASE_URL, \"/smsFilter\"), {\n      params: _defineProperty({\n        token: adminCookie,\n        phone: phone,\n        page: page,\n        date_from: start,\n        date_to: end,\n        sms_type: sms_type\n      }, \"page\", page)\n    }, {\n      headers: {\n        'Access-Control-Allow-Origin': '*',\n        'Content-Type': 'application/json'\n      }\n    }).then(function (res) {\n      setLoading(false);\n\n      if (!res.data.message) {\n        requestUpdate(res);\n      }\n    });\n    axios.get(\"\".concat(process.env.BASE_URL, \"/smsTypes\"), {\n      headers: {\n        'Access-Control-Allow-Origin': '*',\n        'Content-Type': 'application/json'\n      }\n    }).then(function (res) {\n      setLoading(false);\n      setSmsTypes(res.data);\n    });\n  };\n\n  var changePage = function changePage(n) {\n    setFile([]);\n\n    function replaceDate(val) {\n      return String(val).replace(/[^A-Z0-9]/g, '');\n    }\n\n    setLoading(true);\n    axios.get(\"\".concat(process.env.BASE_URL, \"/smsFilter\"), {\n      params: _defineProperty({\n        token: adminCookie,\n        phone: phone,\n        page: page,\n        date_from: start,\n        date_to: end,\n        sms_type: sms_type\n      }, \"page\", n)\n    }, {\n      headers: {\n        'Access-Control-Allow-Origin': '*',\n        'Content-Type': 'application/json'\n      }\n    }).then(function (res) {\n      setLoading(false);\n\n      if (!res.data.message) {\n        requestUpdate(res);\n        router.push(\"/smscenter?page=\".concat(n, \"&phone=\").concat(replaceDate(phoneNumber), \"&start=\").concat(dateFrom, \"&end=\").concat(dateTo, \"&sms_type=\").concat(smsType));\n      }\n    });\n  };\n\n  var onSearch = function onSearch(e) {\n    setFile([]);\n\n    function replaceDate(val) {\n      return String(val).replace(/[^A-Z0-9]/g, '');\n    }\n\n    if (!phoneCheck(phoneNumber)) {\n      setPhoneNumber('');\n    }\n\n    setLoading(true);\n    axios.get(\"\".concat(process.env.BASE_URL, \"/smsFilter\"), {\n      params: {\n        token: adminCookie,\n        phone: replaceDate(phoneNumber),\n        date_from: dateFrom,\n        date_to: dateTo,\n        sms_type: smsType\n      }\n    }, {\n      headers: {\n        'Access-Control-Allow-Origin': '*',\n        'Content-Type': 'application/json'\n      }\n    }).then(function (res) {\n      setLoading(false);\n\n      if (!res.data.message) {\n        requestUpdate(res);\n        router.push(\"/smscenter?phone=\".concat(replaceDate(phoneNumber), \"&start=\").concat(dateFrom, \"&end=\").concat(dateTo, \"&sms_type=\").concat(smsType));\n      }\n    });\n    e.preventDefault();\n  };\n\n  useEffect(function () {\n    onClear();\n  }, []);\n  return /*#__PURE__*/_jsxs(\"div\", {\n    children: [/*#__PURE__*/_jsx(Header, {}), /*#__PURE__*/_jsx(\"main\", {\n      role: \"main\",\n      children: /*#__PURE__*/_jsxs(\"section\", {\n        \"class\": \"panel important\",\n        children: [/*#__PURE__*/_jsx(\"h2\", {\n          className: \"text-center\",\n          children: \"SmsCenter\"\n        }), /*#__PURE__*/_jsxs(\"form\", {\n          className: \"text-center\",\n          onSubmit: onSearch,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"d-flex justify-content-center\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"input-groups d-flex flex-column mr-2\",\n              children: [/*#__PURE__*/_jsx(\"label\", {\n                children: \"\\u041D\\u043E\\u043C\\u0435\\u0440 \\u0442\\u0435\\u043B\\u0435\\u0444\\u043E\\u043D\\u0430:\"\n              }), /*#__PURE__*/_jsx(InputMask, {\n                placeholder: \"+7\",\n                mask: \"+7(999)-999-9999\",\n                maskChar: null,\n                value: phoneNumber,\n                onChange: onChangePhone,\n                beforeMaskedValueChange: beforeMaskedValueChange\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"input-groups d-flex flex-column mr-2\",\n              children: [/*#__PURE__*/_jsx(\"label\", {\n                children: \"\\u0414\\u0430\\u0442\\u0430 \\u043E\\u0442:\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                type: \"date\",\n                value: dateFrom,\n                onChange: function onChange(e) {\n                  return setDateFrom(e.target.value);\n                }\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"input-groups d-flex flex-column mr-2\",\n              children: [/*#__PURE__*/_jsx(\"label\", {\n                children: \"\\u0414\\u0430\\u0442\\u0430 \\u0434\\u043E:\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                type: \"date\",\n                value: dateTo,\n                onChange: function onChange(e) {\n                  return setDateTo(e.target.value);\n                }\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"input-groups d-flex flex-column mr-2\",\n              children: [/*#__PURE__*/_jsx(\"label\", {\n                children: \"\\u0422\\u0438\\u043F \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0439:\"\n              }), /*#__PURE__*/_jsxs(\"select\", {\n                value: smsType,\n                onChange: function onChange(e) {\n                  setSmsType(e.target.value);\n                },\n                children: [/*#__PURE__*/_jsx(\"option\", {\n                  value: \"\",\n                  children: \"\\u0412\\u0441\\u0435\"\n                }), smsTypes.map(function (type) {\n                  return /*#__PURE__*/_jsx(\"option\", {\n                    value: type.id,\n                    children: type.name\n                  });\n                })]\n              })]\n            })]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"text-center\",\n            children: [/*#__PURE__*/_jsx(\"button\", {\n              type: \"submit\",\n              className: \"mr-2 mt-3 btn btn-dark\",\n              children: \"\\u0418\\u0441\\u043A\\u0430\\u0442\\u044C\"\n            }), /*#__PURE__*/_jsx(\"a\", {\n              href: \"/smscenter\",\n              type: \"button\",\n              className: \"mr-2 mt-3 btn btn-light\",\n              onClick: function onClick(e) {\n                clearForm(e);\n              },\n              children: \"\\u0421\\u0431\\u0440\\u043E\\u0441\\u0438\\u0442\\u044C\"\n            })]\n          })]\n        }), file.length !== 0 ? /*#__PURE__*/_jsx(ExportCSV, {\n          fileName: !phone && !end && !start && !sms_type ? 'allresult' : 'phone: ' + phone + ' date_from: ' + start + ' date_to: ' + end + ' sms_type: ' + sms_type,\n          csvData: file\n        }) : /*#__PURE__*/_jsx(\"button\", {\n          className: \"btn btn-info\",\n          onClick: sendRequest,\n          children: \"\\u0413\\u043E\\u0442\\u043E\\u0432\\u0438\\u0442\\u044C \\u0444\\u0430\\u0439\\u043B \\u0434\\u043B\\u044F \\u0432\\u044B\\u0433\\u0440\\u0443\\u0437\\u043A\\u0438\"\n        }), loading ? 'loading....' : /*#__PURE__*/_jsx(SmsList, {\n          from: from,\n          sms: smsList,\n          total: total,\n          currentPage: currentPage\n        }), /*#__PURE__*/_jsx(SmsPagination, {\n          max_page: lastPage,\n          current_page: currentPage,\n          changePage: changePage\n        })]\n      })\n    }), /*#__PURE__*/_jsx(Footer, {})]\n  });\n};\n\nexport default connect(mapStateToProps)(AdminSmsCenter);","map":null,"metadata":{},"sourceType":"module"}
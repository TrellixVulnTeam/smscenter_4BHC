{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport axios from 'axios';\nimport { fetchAnsweredMsg as _fetchAnsweredMsg, fetchNonAnsweredMsg as _fetchNonAnsweredMsg } from '../store/actions/telegram';\nimport { Modal, ModalHeader, ModalBody } from 'reactstrap';\nimport { connect } from 'react-redux';\nimport MessageDetail from '../components/shared/messageDetailed';\nimport { helloUser } from '../defaults/hello';\nimport Header from '../components/admin/Header';\nimport Footer from '../components/admin/Footer';\nimport disableScroll from 'disable-scroll';\nimport cookie from 'js-cookie';\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    nonanswered: state.nonanswered,\n    answered: state.answered\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    fetchAnsweredMsg: function fetchAnsweredMsg() {\n      return dispatch(_fetchAnsweredMsg());\n    },\n    fetchNonAnsweredMsg: function fetchNonAnsweredMsg() {\n      return dispatch(_fetchNonAnsweredMsg());\n    }\n  };\n};\n\nvar Telegram = /*#__PURE__*/function (_React$Component) {\n  _inherits(Telegram, _React$Component);\n\n  var _super = _createSuper(Telegram);\n\n  function Telegram() {\n    var _this;\n\n    _classCallCheck(this, Telegram);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      collapse: \"\",\n      message: '',\n      answer: '',\n      code: '',\n      loading: false,\n      answers: true\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSubmit\", function (msgid, question, iin, id) {\n      var groupText = \"\\n\\u041E\\u0442\\u0432\\u0435\\u0442\\u0438\\u043B\\u0438 \\u043D\\u0430 \\u0432\\u043E\\u043F\\u0440\\u043E\\u0441: \".concat(question, \"%0A \\n\\u0418\\u0418\\u041D: \").concat(iin, \"%0A%0A\\n\").concat(helloUser(), \"!%0A\\n\").concat(_this.state.answer.split('%0A'), \"%0A%0A\\n\\u0421 \\u0443\\u0432\\u0430\\u0436\\u0435\\u043D\\u0438\\u0435\\u043C I-credit.kz%0A%0A\\n   #\\u043E\\u0442\\u0432\\u0435\\u0442\\u0438\\u043B\\u0438 \");\n      var errorMessage = \"\\u041D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C \\u043E\\u0442\\u0432\\u0435\\u0442. \\u041F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044C \\u0431\\u043B\\u043E\\u043A\\u0438\\u0440\\u043E\\u0432\\u0430\\u043B \\u043D\\u0430\\u0448 \\u0442\\u0435\\u043B\\u0435\\u0433\\u0440\\u0430\\u043C \\u0431\\u043E\\u0442-> \\u0418\\u0418\\u041D: \".concat(iin, \"%0A%0A;\\u0412\\u043E\\u043F\\u0440\\u043E\\u0441: \").concat(question, \"%0A #\\u043E\\u0448\\u0438\\u0431\\u043A\\u0430\");\n      var answerText = \"\\n\".concat(helloUser(), \"!%0A\\n\").concat(_this.state.answer.split('%0A'), \"%0A%0A\\n\\u0421 \\u0443\\u0432\\u0430\\u0436\\u0435\\u043D\\u0438\\u0435\\u043C I-credit.kz\\n    \");\n\n      if (_this.state.answer) {\n        // console.log(this.state.answer.length)\n        _this.setState({\n          loading: true\n        });\n\n        axios.post(\"https://api.telegram.org/bot1464143689:AAHakxNTvvBG9qpzrH8Z-lNNyEjAS2aW8-U/sendMessage?chat_id=\".concat(msgid, \"&text=\").concat(answerText, \"&ie=UTF-8&oe=UTF-8&parse_mode=html\")).then(function (response) {\n          if (response.data.ok) {\n            axios.put(\"https://api.money-men.kz/api/telegram/\".concat(id)).then(function (response) {\n              if (response.data.success) {\n                axios.post(\"https://api.telegram.org/bot1464143689:AAHakxNTvvBG9qpzrH8Z-lNNyEjAS2aW8-U/sendMessage?chat_id=-438259555&text=\".concat(groupText, \"&ie=UTF-8&oe=UTF-8&parse_mode=html\"));\n\n                _this.setState({\n                  loading: false\n                });\n\n                _this.setState({\n                  message: 'Отправлено',\n                  collapse: '',\n                  answer: ''\n                });\n\n                setTimeout(function () {\n                  _this.setState({\n                    message: ''\n                  });\n                }, 1500);\n\n                _this.props.fetchNonAnsweredMsg();\n\n                _this.props.fetchAnsweredMsg();\n              }\n            });\n          } else {\n            _this.setState({\n              message: 'Не отправлено'\n            });\n\n            setTimeout(function () {\n              _this.setState({\n                message: '',\n                collapse: '',\n                answer: ''\n              });\n            }, 1500);\n          }\n        })[\"catch\"](function (error) {\n          if (error.response) {\n            axios.put(\"https://api.money-men.kz/api/telegram/\".concat(id)).then(function (response) {\n              axios.post(\"https://api.telegram.org/bot1464143689:AAHakxNTvvBG9qpzrH8Z-lNNyEjAS2aW8-U/sendMessage?chat_id=-438259555&text=\".concat(errorMessage, \"&ie=UTF-8&oe=UTF-8&parse_mode=html\")).then(function (res) {\n                location.reload();\n              });\n            });\n          }\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleChange\", function (event) {\n      // const value = event.target.value.replace(/[\\r\\n\\v]+/g, \"\");\n      _this.setState({\n        answer: event.target.value\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleCode\", function (event) {\n      _this.setState({\n        code: event.target.value\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleRecommend\", function (e) {\n      _this.setState({\n        answer: e.target.value\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"submitCode\", function () {\n      if (_this.state.code === 'admin123') {\n        cookie.set('botmsg', '3917', {\n          expires: 60\n        });\n        location.reload();\n      } else {\n        alert('Ошибка кода');\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"toggleCollapse\", function (id) {\n      return function () {\n        if (!_this.state.collapse || id !== _this.state.collapse) {\n          _this.setState({\n            collapse: id\n          });\n        } else if (_this.state.collapse === id) {\n          _this.setState({\n            collapse: false\n          });\n        }\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleAnswered\", function () {\n      _this.setState(function (prev) {\n        return {\n          answers: !prev.answers\n        };\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(Telegram, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.props.fetchNonAnsweredMsg();\n      this.props.fetchAnsweredMsg();\n    }\n  }, {\n    key: \"keypress\",\n    value: function keypress(event, msgid, question, iin, id) {\n      if (event.keyCode == 13 && event.shiftKey) {\n        this.handleSubmit(msgid, question, iin, id);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      // if (this.props.nonanswered.nonanswered.length === 0 && this.props.nonanswered.isLoading=== false) {\n      //     return (<div className='mb-5 container otherPages'>\n      //          {this.state.answers ?  <button active className='btn btn-dark mb-3' onClick={() => this.handleAnswered()}>Получить неотвеченные</button> \n      //         :   <button active className='btn btn-dark mb-3 mr-3' onClick={() => this.handleAnswered()}>Получить отвеченные</button>}\n      //         <h4 className='mb-3 text-center'>Неотвеченные вопросы</h4>\n      //         <p className='text-center'>Нет вопросов</p>\n      //     </div>)\n      // }\n      if (this.props.nonanswered.isLoading) {\n        return /*#__PURE__*/_jsxs(_Fragment, {\n          children: [/*#__PURE__*/_jsx(Header, {}), /*#__PURE__*/_jsx(\"div\", {\n            className: \"container  otherPages text-center\",\n            children: \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430.......\"\n          }), /*#__PURE__*/_jsx(Footer, {})]\n        });\n      }\n\n      if (!this.state.answers && !this.props.answered.isLoading) {\n        return /*#__PURE__*/_jsxs(_Fragment, {\n          children: [/*#__PURE__*/_jsx(Header, {}), /*#__PURE__*/_jsx(\"main\", {\n            role: \"main\",\n            children: /*#__PURE__*/_jsx(\"section\", {\n              \"class\": \"panel important\",\n              children: /*#__PURE__*/_jsxs(\"div\", {\n                className: \"container otherPages\",\n                children: [this.state.answers ? /*#__PURE__*/_jsx(\"button\", {\n                  active: true,\n                  className: \"btn btn-dark mb-3\",\n                  onClick: function onClick() {\n                    return _this2.handleAnswered();\n                  },\n                  children: \"\\u041F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u044C \\u043E\\u0442\\u0432\\u0435\\u0447\\u0435\\u043D\\u043D\\u044B\\u0435\"\n                }) : /*#__PURE__*/_jsx(\"button\", {\n                  active: true,\n                  className: \"btn btn-dark mb-3 mr-3\",\n                  onClick: function onClick() {\n                    return _this2.handleAnswered();\n                  },\n                  children: \"\\u041F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u044C \\u043D\\u0435\\u043E\\u0442\\u0432\\u0435\\u0447\\u0435\\u043D\\u043D\\u044B\\u0435\"\n                }), this.state.message.length > 0 ? /*#__PURE__*/_jsx(\"div\", {\n                  className: \"tlgmsg alert alert-info\",\n                  children: this.state.message\n                }) : /*#__PURE__*/_jsx(\"div\", {}), /*#__PURE__*/_jsxs(\"h4\", {\n                  className: \"mb-3 text-center\",\n                  children: [\"\\u041E\\u0442\\u0432\\u0435\\u0447\\u0435\\u043D\\u043D\\u044B\\u0435 \\u0432\\u043E\\u043F\\u0440\\u043E\\u0441\\u044B \\u0437\\u0430 \\u043D\\u0435\\u0434\\u0435\\u043B\\u044E (\", this.props.answered.answered.length, \")\"]\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: \"row\",\n                  children: this.props.answered.answered.map(function (elem) {\n                    return /*#__PURE__*/_jsx(\"div\", {\n                      className: \"col-md-4\",\n                      children: /*#__PURE__*/_jsx(\"div\", {\n                        className: \"card mt-2 answeredCard\",\n                        children: /*#__PURE__*/_jsxs(\"div\", {\n                          className: \"card-body\",\n                          children: [/*#__PURE__*/_jsxs(\"p\", {\n                            className: \"tinydate\",\n                            children: [\"\\u0417\\u0430\\u0434\\u0430\\u043D\\u043E: \", new Intl.DateTimeFormat('ru', {\n                              year: 'numeric',\n                              month: 'short',\n                              day: '2-digit',\n                              hour: 'numeric',\n                              minute: 'numeric'\n                            }).format(new Date(Date.parse(elem.created_at)))]\n                          }), /*#__PURE__*/_jsxs(\"p\", {\n                            className: \"tinydate\",\n                            children: [\"\\u041E\\u0442\\u0432\\u0435\\u0447\\u0435\\u043D\\u043E: \", new Intl.DateTimeFormat('ru', {\n                              year: 'numeric',\n                              month: 'short',\n                              day: '2-digit',\n                              hour: 'numeric',\n                              minute: 'numeric'\n                            }).format(new Date(Date.parse(elem.updated_at)))]\n                          }), /*#__PURE__*/_jsxs(\"p\", {\n                            className: \"card-text\",\n                            children: [\"\\u0418\\u043C\\u044F: \", elem.name, \" \", /*#__PURE__*/_jsx(\"br\", {}), \"\\u0418\\u0418\\u041D: \", elem.iin]\n                          }), /*#__PURE__*/_jsxs(\"i\", {\n                            children: [\"\\u0412\\u043E\\u043F\\u0440\\u043E\\u0441: \", elem.question]\n                          })]\n                        })\n                      }, elem.id)\n                    });\n                  })\n                })]\n              })\n            })\n          }), /*#__PURE__*/_jsx(Footer, {})]\n        });\n      } else return /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsx(Header, {}), /*#__PURE__*/_jsx(\"main\", {\n          role: \"main\",\n          children: /*#__PURE__*/_jsx(\"section\", {\n            \"class\": \"panel important\",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \"container otherPages\",\n              children: [this.state.answers ? /*#__PURE__*/_jsx(\"button\", {\n                active: true,\n                className: \"btn btn-dark mb-3\",\n                onClick: function onClick() {\n                  return _this2.handleAnswered();\n                },\n                children: \"\\u041F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u044C \\u043E\\u0442\\u0432\\u0435\\u0447\\u0435\\u043D\\u043D\\u044B\\u0435\"\n              }) : /*#__PURE__*/_jsx(\"button\", {\n                active: true,\n                className: \"btn btn-dark mb-3 mr-3\",\n                onClick: function onClick() {\n                  return _this2.handleAnswered();\n                },\n                children: \"\\u041F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u044C \\u043D\\u0435\\u043E\\u0442\\u0432\\u0435\\u0447\\u0435\\u043D\\u043D\\u044B\\u0435\"\n              }), this.state.message.length > 0 ? /*#__PURE__*/_jsx(\"div\", {\n                className: \"tlgmsg alert alert-info\",\n                children: this.state.message\n              }) : /*#__PURE__*/_jsx(\"div\", {}), /*#__PURE__*/_jsxs(\"h4\", {\n                className: \"mb-3 text-center\",\n                children: [\"\\u041D\\u0435\\u043E\\u0442\\u0432\\u0435\\u0447\\u0435\\u043D\\u043D\\u044B\\u0435 \\u0432\\u043E\\u043F\\u0440\\u043E\\u0441\\u044B (\", this.props.nonanswered.nonanswered.length, \")\"]\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"row\",\n                children: this.props.nonanswered.nonanswered.map(function (elem) {\n                  return /*#__PURE__*/_jsx(\"div\", {\n                    className: \"col-md-4\",\n                    children: /*#__PURE__*/_jsx(\"div\", {\n                      className: \"card mt-2\",\n                      onClick: _this2.toggleCollapse(elem.id),\n                      children: /*#__PURE__*/_jsxs(\"div\", {\n                        className: \"card-body\",\n                        children: [/*#__PURE__*/_jsx(\"p\", {\n                          className: \"tinydate\",\n                          children: new Intl.DateTimeFormat('ru', {\n                            year: 'numeric',\n                            month: 'short',\n                            day: '2-digit',\n                            hour: 'numeric',\n                            minute: 'numeric'\n                          }).format(new Date(Date.parse(elem.created_at)))\n                        }), /*#__PURE__*/_jsxs(\"p\", {\n                          className: \"card-text\",\n                          children: [\"\\u0418\\u043C\\u044F: \", elem.name, \" \", /*#__PURE__*/_jsx(\"br\", {}), \"\\u0418\\u0418\\u041D: \", elem.iin]\n                        }), /*#__PURE__*/_jsxs(\"i\", {\n                          children: [\"\\u0412\\u043E\\u043F\\u0440\\u043E\\u0441: \", elem.question]\n                        })]\n                      })\n                    }, elem.id)\n                  });\n                })\n              }), /*#__PURE__*/_jsx(Modal, {\n                isOpen: this.state.collapse,\n                toggle: this.toggleCollapse(this.state.collapse),\n                size: \"lg\",\n                children: /*#__PURE__*/_jsx(ModalBody, {\n                  children: /*#__PURE__*/_jsx(MessageDetail, {\n                    msg: this.props.nonanswered.nonanswered.filter(function (el) {\n                      return el.id === parseInt(_this2.state.collapse);\n                    })[0],\n                    answer: this.state.answer,\n                    handleChange: this.handleChange,\n                    handleSubmit: this.handleSubmit,\n                    handleRecommend: this.handleRecommend,\n                    keypress: this.keypress,\n                    loading: this.state.loading\n                  })\n                })\n              })]\n            })\n          })\n        }), /*#__PURE__*/_jsx(Footer, {})]\n      });\n    }\n  }]);\n\n  return Telegram;\n}(React.Component);\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Telegram);","map":null,"metadata":{},"sourceType":"module"}
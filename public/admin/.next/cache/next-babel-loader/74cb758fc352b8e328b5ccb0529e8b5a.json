{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport axios from 'axios';\nimport React, { useState, useEffect } from 'react';\nimport Header from '../components/admin/Header';\nimport Footer from '../components/admin/Footer';\nimport swal from \"sweetalert\";\nimport cookie from 'js-cookie';\nimport { useDispatch, connect } from 'react-redux';\nimport { Modal, ModalHeader, ModalBody } from 'reactstrap';\n\nfunction mapStateToProps(state) {\n  return {\n    adminReducer: state.adminReducer\n  };\n}\n\nvar AdminUsers = function AdminUsers(_ref) {\n  var _jsxs2;\n\n  var adminReducer = _ref.adminReducer;\n  var dispatch = useDispatch();\n\n  var _useState = useState(true),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState([]),\n      users = _useState2[0],\n      setUsers = _useState2[1];\n\n  var _useState3 = useState(''),\n      edit = _useState3[0],\n      setEdit = _useState3[1];\n\n  var _useState4 = useState({\n    id: null,\n    name: null,\n    email: null,\n    role_id: null\n  }),\n      userDate = _useState4[0],\n      setUserDate = _useState4[1];\n\n  var _useState5 = useState({\n    name: null,\n    email: null,\n    password: 'icredit123',\n    role_id: 2\n  }),\n      newUser = _useState5[0],\n      setNewUser = _useState5[1];\n\n  var _useState6 = useState(false),\n      showModal = _useState6[0],\n      setShowModal = _useState6[1];\n\n  var finalUser = users.filter(function (user) {\n    return user.id !== adminReducer.user.id;\n  });\n\n  var handleClose = function handleClose() {\n    setShowModal(false);\n    setNewUser({\n      name: null,\n      email: null,\n      password: 'icredit123',\n      role_id: 2\n    });\n  };\n\n  var handleShow = function handleShow() {\n    return setShowModal(true);\n  };\n\n  var getUser = function getUser() {\n    axios.get(\"\".concat(process.env.BASE_URL, \"/users\"), {\n      headers: {\n        'Access-Control-Allow-Origin': '*',\n        'Content-Type': 'application/json'\n      }\n    }).then(function (res) {\n      setUsers(res.data);\n      setLoading(false);\n    });\n  };\n\n  useEffect(function () {\n    getUser();\n  }, []);\n\n  var editAccount = function editAccount(id) {\n    setEdit(id);\n    var user = users.filter(function (user) {\n      return user.id === id;\n    });\n    setUserDate({\n      id: id,\n      name: user[0].name,\n      email: user[0].email,\n      role_id: user[0].role_id\n    });\n  };\n\n  var userAdd = function userAdd(e) {\n    axios.post(\"\".concat(process.env.BASE_URL, \"/users\"), {\n      name: newUser.name,\n      email: newUser.email,\n      password: newUser.password,\n      role_id: newUser.role_id,\n      token: cookie.get('admin_token')\n    }, {\n      headers: {\n        'Access-Control-Allow-Origin': '*',\n        'Content-Type': 'application/json'\n      }\n    }).then(function (res) {\n      if (res.data.success) {\n        dispatch({\n          type: 'ADM_SUCCESS_MESSAGE',\n          payload: res.data.message\n        });\n        getUser();\n        handleClose();\n      } else {\n        dispatch({\n          type: 'ADM_ERROR_MESSAGE',\n          payload: res.data.message\n        });\n      }\n    });\n    e.preventDefault();\n  };\n\n  var saveEdit = function saveEdit() {\n    axios.put(\"\".concat(process.env.BASE_URL, \"/edit\"), {\n      token: cookie.get('admin_token'),\n      email: userDate.email,\n      name: userDate.name,\n      role_id: userDate.role_id,\n      user_id: userDate.id\n    }, {\n      headers: {\n        'Access-Control-Allow-Origin': '*',\n        'Content-Type': 'application/json'\n      }\n    }).then(function (res) {\n      if (res.data.success) {\n        dispatch({\n          type: 'ADM_SUCCESS_MESSAGE',\n          payload: res.data.message\n        });\n        setEdit('');\n        getUser();\n      } else {\n        dispatch({\n          type: 'ADM_ERROR_MESSAGE',\n          payload: res.data.message\n        });\n        getUser();\n      }\n    });\n  };\n\n  var deleteAccount = function deleteAccount(id) {\n    swal({\n      title: 'Вы уверены, что хотите удалить пользователя',\n      buttons: {\n        \"catch\": {\n          text: 'Да',\n          value: 'yes'\n        },\n        cancel: 'Нет'\n      }\n    }).then(function (value) {\n      switch (value) {\n        case 'yes':\n          axios.get(\"\".concat(process.env.BASE_URL, \"/deleteAccount?token=\").concat(cookie.get('admin_token'), \"&user_id=\").concat(id), {\n            headers: {\n              'Access-Control-Allow-Origin': '*'\n            }\n          }).then(function (response) {\n            if (response.data.success) {\n              dispatch({\n                type: 'ADM_SUCCESS_MESSAGE',\n                payload: response.data.message\n              });\n              getUser();\n            } else {\n              dispatch({\n                type: 'ADM_ERROR_MESSAGE',\n                payload: response.data.message\n              });\n            }\n          });\n      }\n    });\n  };\n\n  var cancelEdit = function cancelEdit() {\n    setEdit('');\n    getUser();\n  };\n\n  var userTable = function userTable(edit, user, index) {\n    if (edit === user.id) {\n      return /*#__PURE__*/_jsxs(\"tr\", {\n        children: [/*#__PURE__*/_jsx(\"th\", {\n          scope: \"row\",\n          children: index + 1\n        }), /*#__PURE__*/_jsx(\"td\", {\n          children: /*#__PURE__*/_jsx(\"input\", {\n            onChange: function onChange(e) {\n              return setUserDate({\n                id: userDate.id,\n                name: e.target.value,\n                email: userDate.email,\n                role_id: userDate.role_id\n              });\n            },\n            value: userDate.name\n          })\n        }), /*#__PURE__*/_jsx(\"td\", {\n          children: /*#__PURE__*/_jsx(\"input\", {\n            onChange: function onChange(e) {\n              return setUserDate({\n                id: userDate.id,\n                name: userDate.name,\n                email: e.target.value,\n                role_id: userDate.role_id\n              });\n            },\n            value: userDate.email\n          })\n        }), /*#__PURE__*/_jsx(\"td\", {\n          children: /*#__PURE__*/_jsxs(\"select\", {\n            onChange: function onChange(e) {\n              return setUserDate({\n                id: userDate.id,\n                name: userDate.name,\n                email: userDate.email,\n                role_id: e.target.value\n              });\n            },\n            value: userDate.role_id,\n            children: [/*#__PURE__*/_jsx(\"option\", {\n              value: \"1\",\n              children: \"Admin\"\n            }), /*#__PURE__*/_jsx(\"option\", {\n              value: \"2\",\n              children: \"Moderator\"\n            })]\n          })\n        }), /*#__PURE__*/_jsxs(\"td\", {\n          children: [/*#__PURE__*/_jsx(\"button\", {\n            className: \"btn btn-success mr-2\",\n            onClick: function onClick() {\n              return saveEdit();\n            },\n            children: \"Save\"\n          }), /*#__PURE__*/_jsx(\"button\", {\n            className: \"btn btn-danger\",\n            onClick: function onClick() {\n              return cancelEdit();\n            },\n            children: \"Cancel\"\n          })]\n        })]\n      }, userDate.id);\n    } else return /*#__PURE__*/_jsxs(\"tr\", {\n      children: [/*#__PURE__*/_jsx(\"th\", {\n        scope: \"row\",\n        children: index + 1\n      }), /*#__PURE__*/_jsx(\"td\", {\n        children: user.name\n      }), /*#__PURE__*/_jsx(\"td\", {\n        children: user.email\n      }), /*#__PURE__*/_jsx(\"td\", {\n        children: user.role_id === 1 ? 'Admin' : 'Moderator'\n      }), /*#__PURE__*/_jsxs(\"td\", {\n        children: [/*#__PURE__*/_jsx(\"button\", {\n          className: \"btn btn-success mr-2\",\n          disabled: adminReducer.user.role_id === 1 ? false : true,\n          onClick: function onClick() {\n            return editAccount(user.id);\n          },\n          children: \"Edit\"\n        }), /*#__PURE__*/_jsx(\"button\", {\n          className: \"btn btn-danger\",\n          disabled: adminReducer.user.role_id === 1 ? false : true,\n          onClick: function onClick() {\n            return deleteAccount(user.id);\n          },\n          children: \"Delete\"\n        })]\n      })]\n    }, user.id);\n  };\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    children: [/*#__PURE__*/_jsx(Header, {}), /*#__PURE__*/_jsx(\"main\", {\n      role: \"main\",\n      children: /*#__PURE__*/_jsxs(\"section\", {\n        \"class\": \"panel important\",\n        children: [loading ? /*#__PURE__*/_jsx(\"div\", {\n          children: \"\\u0417\\u0430\\u0433\\u0443\\u0437\\u043A\\u0430...\"\n        }) : /*#__PURE__*/_jsxs(\"div\", {\n          className: \"container\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"d-flex mb-3 justify-content-between\",\n            children: [/*#__PURE__*/_jsx(\"h2\", {\n              children: \"Users\"\n            }), /*#__PURE__*/_jsxs(\"button\", {\n              className: \"btn btn-info\",\n              onClick: handleShow,\n              disabled: adminReducer.user.role_id === 1 ? false : true,\n              children: [\"\\u041D\\u043E\\u0432\\u044B\\u0439 \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044C \", /*#__PURE__*/_jsx(\"b\", {\n                children: \"+\"\n              })]\n            })]\n          }), /*#__PURE__*/_jsxs(\"table\", {\n            className: \"table table-striped\",\n            children: [/*#__PURE__*/_jsx(\"thead\", {\n              children: /*#__PURE__*/_jsxs(\"tr\", {\n                children: [/*#__PURE__*/_jsx(\"th\", {\n                  scope: \"col\",\n                  children: \"#\"\n                }), /*#__PURE__*/_jsx(\"th\", {\n                  scope: \"col\",\n                  children: \"\\u0418\\u043C\\u044F\"\n                }), /*#__PURE__*/_jsx(\"th\", {\n                  scope: \"col\",\n                  children: \"Username\"\n                }), /*#__PURE__*/_jsx(\"th\", {\n                  scope: \"col\",\n                  children: \"\\u0420\\u043E\\u043B\\u044C\"\n                }), /*#__PURE__*/_jsx(\"th\", {\n                  scope: \"col\",\n                  children: \"\\u0414\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u0435\"\n                })]\n              })\n            }), /*#__PURE__*/_jsx(\"tbody\", {\n              children: finalUser.map(function (user, index) {\n                return userTable(edit, user, index);\n              })\n            })]\n          })]\n        }), /*#__PURE__*/_jsx(Modal, {\n          isOpen: showModal,\n          toggle: function toggle() {\n            return handleClose(showModal);\n          },\n          size: \"md\",\n          children: /*#__PURE__*/_jsx(ModalBody, {\n            children: /*#__PURE__*/_jsxs(\"form\", {\n              className: \"form-group\",\n              onSubmit: function onSubmit(e) {\n                return userAdd(e);\n              },\n              children: [/*#__PURE__*/_jsx(\"input\", {\n                onChange: function onChange(e) {\n                  return setNewUser({\n                    password: newUser.password,\n                    name: e.target.value,\n                    email: newUser.email,\n                    role_id: newUser.role_id\n                  });\n                },\n                value: newUser.name,\n                className: \"input-group mb-2\",\n                type: \"text\",\n                placeholder: \"\\u0418\\u043C\\u044F\"\n              }), /*#__PURE__*/_jsx(\"input\", {\n                onChange: function onChange(e) {\n                  return setNewUser({\n                    password: newUser.password,\n                    name: newUser.name,\n                    email: e.target.value,\n                    role_id: newUser.role_id\n                  });\n                },\n                value: newUser.email,\n                className: \"input-group mt-2\",\n                type: \"text\",\n                placeholder: \"Username\"\n              }), /*#__PURE__*/_jsxs(\"select\", (_jsxs2 = {\n                onChange: function onChange(e) {\n                  return setNewUser({\n                    password: newUser.password,\n                    name: newUser.name,\n                    email: newUser.email,\n                    role_id: e.target.value\n                  });\n                },\n                value: newUser.email\n              }, _defineProperty(_jsxs2, \"value\", newUser.role_id), _defineProperty(_jsxs2, \"className\", \"input-group mt-2\"), _defineProperty(_jsxs2, \"children\", [/*#__PURE__*/_jsx(\"option\", {\n                value: \"1\",\n                children: \"Admin\"\n              }), /*#__PURE__*/_jsx(\"option\", {\n                value: \"2\",\n                children: \"Moderator\"\n              })]), _jsxs2)), /*#__PURE__*/_jsx(\"button\", {\n                className: \"btn btn-info mt-2\",\n                disabled: adminReducer.user.role_id === 1 ? false : true,\n                children: \"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C\"\n              })]\n            })\n          })\n        })]\n      })\n    }), /*#__PURE__*/_jsx(Footer, {})]\n  });\n};\n\nexport default connect(mapStateToProps)(AdminUsers);","map":null,"metadata":{},"sourceType":"module"}